<h2 class="test-title">
  英検 <%= @test.level %> - <%= @test.series %> テスト結果
</h2>

<p class="score">
  正解数:
  <%= @test.score || 0 %> / <%= @test.test_questions.count %>｜
  <%= @test.passed ? "✅ 合格" : "❌ 不合格（練習モード）" %>
</p>

<div class="results-container">
  <% @questions.each_with_index do |q, i| %>
    <% vocab = q.vocabulary %>

    <% user_answer = q.user_answer.to_s.strip %>
    <% correct_answer = vocab.japanese %>

    <% is_correct =
      q.result == "〇" ||
      user_answer.casecmp?(correct_answer)
    %>

    <div class="result-card <%= is_correct ? 'correct' : 'wrong' %>">
      <div class="card-header">
        <span>Q<%= i + 1 %></span>
        <span><%= is_correct ? "⭕" : "❌" %></span>
      </div>

      <div class="card-body">
        <p><strong>問題:</strong> <%= vocab.english %></p>
        <p><strong>あなたの解答:</strong> <%= user_answer.presence || "未回答" %></p>
        <p><strong>正解:</strong> <%= correct_answer %></p>
      </div>
    </div>
  <% end %>
</div>

<div class="btn-wrapper">
  <%= link_to "＜ 単語リストへ戻る",
    level_vocabularies_path(level: @test.level),
    class: "btn-retry" %>
</div>
